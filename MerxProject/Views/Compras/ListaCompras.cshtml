@model MerxProject.Models.PaginadorGenerico<MerxProject.Models.Compra>

@{
    ViewBag.Title = "ListaCompras";
}
<h2>Compras</h2>
<button class="btn btn-primary btn-sm pull-right" data-toggle="modal" id="Nuevo">Nuevo</button>
<div class="modal fade" data-keyboard="false" data-backdrop="static" id="idModalRegistrar" tabindex="-1"
     data-url='@Url.Action("popUpCompras", "Compras", new { applicationUser = "", accion = "1" })'></div>

<br />
@using (Html.BeginForm("BuscarLista", "Compras", FormMethod.Post))
{
    <div class="container">
        <div class="row">
            <div class="col-xs-8">
                <div class="input-group" style="display: inline; vertical-align: top; line-height: 28px;">
                    <input type="text" class="form-control" name="parameter" placeholder="Buscar...">
                    <input type="submit" name="Subir" value="Buscar" class="btn btn-primary" />
                </div>
            </div>
        </div>
    </div>
}
<br />
<table class="table">
    <tr>
        <th>
            @Html.DisplayName("Folio")
        </th>
        <th>
            @Html.DisplayName("Proveedor")
        </th>
        <th>
            @Html.DisplayName("Empleado")
        </th>
        <th>
            @Html.DisplayName("Monto Total")
        </th>
        <th>
            @Html.DisplayName("Fecha de Registro")
        </th>
        <th>
            @Html.DisplayName("Estatus")
        </th>
    </tr>

    @foreach (var item in Model.Resultado)
    {
        <tr>
            <td>
                @Html.DisplayFor(modelItem => item.Folio)
            </td>
            <td>
                @Html.DisplayFor(modelItem => item.Proveedor.Persona.Nombre)
            </td>
            <td>
                @Html.DisplayFor(modelItem => item.Empleado.Personass.Nombre)
            </td>
            <td>
                $
                @Html.DisplayFor(modelItem => item.MontoTotal)
            </td>
            <td>
                @Html.DisplayFor(modelItem => item.FechaRegistro)
            </td>
            <td>
                @Html.DisplayFor(modelItem => item.DS_Estatus)
            </td>
            <td>
                <button class="btn btn-primary btn-sm" data-toggle="modal" id="details_@item.Id"
                        onclick="createModal('@Url.Action("ListaDetalleCompra", "Compras" , new {idCompra=item.Id, accion = "4" })')">
                    Detalles
                </button>
                @if (item.Estatus < 2)
                {
                    if (item.Estatus > 0)
                    {
                        <button type="submit" class="btn btn-primary btn-sm" data-toggle="modal" id="ent_@item.Id"
                                onclick="createModal('@Url.Action("popUpCompras", "Compras", new { id = item.Id, accion = "5" })')">
                            Marcar como Entregada
                        </button>
                    }
                    if (item.Estatus == 0)
                    {
                        <button type="submit" class="btn btn-primary btn-sm" data-toggle="modal" id="ent_@item.Id"
                                disabled>
                            Marcar como Entregada
                        </button>
                    }
                    <button type="submit" class="btn btn-primary btn-sm" data-toggle="modal" id="edit_@item.Id"
                            onclick="createModal('@Url.Action("popUpCompras", "Compras", new { id = item.Id, accion = "2" })')">
                        Editar
                    </button>
                    <button class="btn btn-primary btn-sm" data-toggle="modal" id="Elimninar" id="delete_@item.Id"
                            onclick="createModal('@Url.Action("popUpCompras", "Compras", new { id = item.Id, accion = "3" })')">
                        Cancelar
                    </button>
                }
                @if (item.Estatus >= 2)
                {
                    <button type="submit" class="btn btn-primary btn-sm" data-toggle="modal" id="ent_@item.Id"
                            disabled>
                        Marcar como Entregada
                    </button>
                    <button type="submit" class="btn btn-primary btn-sm" data-toggle="modal" id="edit_@item.Id"
                            disabled>
                        Editar
                    </button>
                    <button class="btn btn-primary btn-sm" data-toggle="modal" id="Elimninar" id="delete_@item.Id"
                            disabled>
                        Cancelar
                    </button>
                }
            </td>
        </tr>

    }
</table>



@*Paginador de registros*@
@if (Model.Resultado.Count() > 0)
{
    <span>
        <strong>@Model.TotalRegistros</strong> registros encontrados
    </span>
    <span>&nbsp;|&nbsp;</span>
    <span>
        Página <strong>@(Model.PaginaActual)</strong> de
        <strong>@Model.TotalPaginas</strong>
    </span>
    <span>&nbsp;|&nbsp;</span>
}
else
{
    <span>No hay resultados para esta búsqueda</span>
    <span>&nbsp;|&nbsp;</span>
}
@if (Model.PaginaActual > 1)
{
    @Html.ActionLink("<<", "ListaCompras", new { pagina = 1 },
        new { @class = "btn btn-sm btn-default"})
    <span></span>
    @Html.ActionLink("Anterior", "ListaCompras", new { pagina = Model.PaginaActual - 1 },
        new { @class = "btn btn-sm btn-default" });
}
else
{
    @Html.ActionLink("<<", "ListaCompras", new { pagina = 1 },
        new { @class = "btn btn-sm btn-default disabled" })
    <span></span>
    @Html.ActionLink("Anterior", "ListaCompras", new { pagina = 1 },
        new { @class = "btn btn-sm btn-default disabled" })
}
<span></span>
@if (Model.PaginaActual < Model.TotalPaginas)
{
    @Html.ActionLink("Siguiente", "ListaCompras", new { pagina = Model.PaginaActual + 1 },
                    new { @class = "btn btn-sm btn-default" })
    <span></span>
    @Html.ActionLink(">>", "ListaCompras", new { pagina = Model.TotalPaginas },
                    new { @class = "btn btn-sm btn-default" })
}
else
{
    @Html.ActionLink("Siguiente", "ListaCompras", new { pagina = Model.TotalPaginas - 1 },
                    new { @class = "btn btn-sm btn-default disabled" })
    <span></span>
    @Html.ActionLink(">>", "ListaCompras", new { pagina = Model.TotalPaginas },
                    new { @class = "btn btn-sm btn-default disabled" })
}

<div class="modal fade" data-keyboard="false" data-backdrop="static" id="idModalUpdate" tabindex="-1"></div>
<div class="modal fade" data-keyboard="false" data-backdrop="static" id="idModalElminar" tabindex="-1"></div>
<div class="modal fade" data-keyboard="false" data-backdrop="static" id="idModalDetalles" tabindex="-1"></div>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
<script type="text/javascript">

    $(document).ready(function () {
        $('#Nuevo').click(function () {
            var url = $('#idModalRegistrar').data('url');
            $.get(url, function (data) {
                $("#idModalRegistrar").html(data);
                $("#idModalRegistrar").modal('show');
            });
        });
    });


    function createModal(url) {
        $.get(url, function (data) {
            $("#idModalUpdate").html(data);
            $("#idModalUpdate").modal('show');
        });

    }

    function createModal(url) {
        $.get(url, function (data) {

        });

    }

    function createModal(url) {
        $.get(url, function (data) {
            $("#idModalDetalles").html(data);
            $("#idModalDetalles").modal('show');
        });

    }


</script>

@section Scripts {
    @Scripts.Render("~/bundles/jqueryval")
}